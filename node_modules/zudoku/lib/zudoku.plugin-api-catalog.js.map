{"version":3,"file":"zudoku.plugin-api-catalog.js","sources":["../src/lib/plugins/api-catalog/Catalog.tsx","../src/lib/plugins/api-catalog/index.tsx"],"sourcesContent":["import { useSuspenseQuery } from \"@tanstack/react-query\";\nimport { Helmet } from \"@zudoku/react-helmet-async\";\nimport { useMatch } from \"react-router\";\nimport { Link } from \"zudoku/components\";\nimport { useAuthState } from \"../../authentication/state.js\";\nimport { Heading } from \"../../components/Heading.js\";\nimport { Markdown } from \"../../components/Markdown.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { type ApiCatalogPluginOptions, getKey } from \"./index.js\";\n\nexport const Catalog = ({\n  items,\n  filterCatalogItems = (items) => items,\n  label = \"API Library\",\n  categoryLabel,\n}: Omit<ApiCatalogPluginOptions, \"navigationId\"> & {\n  categoryLabel?: string;\n}) => {\n  const auth = useAuthState();\n  const match = useMatch({ path: \"/catalog/:category\" });\n  const activeCategory = match?.params.category;\n\n  const catalogItems = useSuspenseQuery({\n    queryFn: () => filterCatalogItems(items, { auth }),\n    queryKey: [\"catalogItems\", auth],\n  });\n\n  // Only index the overview page, ignore the rest\n  const dataSet = activeCategory ? { \"data-pagefind-ignore\": \"all\" } : {};\n\n  return (\n    <section className=\"pt-[--padding-content-top]\" {...dataSet}>\n      <Helmet>\n        <title>\n          {categoryLabel ? `${categoryLabel} - ` : \"\"}\n          {label}\n        </title>\n      </Helmet>\n      <div className=\"grid gap-4\">\n        <Heading level={2}>\n          {label}\n          {categoryLabel && ` - ${categoryLabel}`}\n        </Heading>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          {catalogItems.data\n            .filter(\n              (api) =>\n                !activeCategory ||\n                api.categories.find((c) =>\n                  c.tags.find((t) => getKey(c.label, t) === activeCategory),\n                ),\n            )\n            .map((api) => (\n              <Link\n                to={joinUrl(api.path)}\n                className=\"no-underline hover:!text-foreground\"\n                key={api.path}\n              >\n                <div className=\"border h-full rounded-lg p-4 flex flex-col gap-2 cursor-pointer hover:bg-border/20 font-normal\">\n                  <span className=\"font-semibold\">{api.label}</span>\n                  <Markdown\n                    className=\"text-sm whitespace-pre-wrap mb-6 line-clamp-2\"\n                    content={api.description}\n                  />\n                </div>\n              </Link>\n            ))}\n        </div>\n      </div>\n    </section>\n  );\n};\n","import slugify from \"@sindresorhus/slugify\";\nimport { matchPath } from \"react-router\";\nimport type { SidebarItem } from \"../../../config/validators/SidebarSchema.js\";\nimport type { AuthState } from \"../../authentication/state.js\";\nimport type { ZudokuPlugin } from \"../../core/plugins.js\";\nimport { joinUrl } from \"../../util/joinUrl.js\";\nimport { Catalog } from \"./Catalog.js\";\n\nexport const getKey = (category: string, tag: string) =>\n  slugify(`${category}-${tag}`);\n\nexport type ApiCatalogItem = {\n  path: string;\n  label: string;\n  description: string;\n  categories: CatalogCategory[];\n};\n\nexport type CatalogCategory = {\n  label: string;\n  tags: string[];\n};\n\nexport type ApiCatalogPluginOptions = {\n  navigationId: string;\n  label: string;\n  categories?: CatalogCategory[];\n  items: ApiCatalogItem[];\n  filterCatalogItems?: filterCatalogItems;\n};\n\nexport type CatalogContext<ProviderData = unknown> = {\n  auth: AuthState<ProviderData>;\n};\n\nexport type filterCatalogItems<ProviderData = unknown> = (\n  items: ApiCatalogItem[],\n  { auth }: CatalogContext<ProviderData>,\n) => ApiCatalogItem[];\n\nexport const apiCatalogPlugin = ({\n  navigationId,\n  items,\n  label,\n  categories = [],\n  filterCatalogItems,\n}: {\n  navigationId: string;\n  label: string;\n  categories?: CatalogCategory[];\n  items: ApiCatalogItem[];\n  filterCatalogItems?: filterCatalogItems;\n}): ZudokuPlugin => {\n  const paths = Object.fromEntries(\n    categories.flatMap((category) =>\n      [undefined, ...category.tags].map((tag) => [\n        joinUrl(navigationId, tag ? getKey(category.label, tag) : undefined),\n        tag,\n      ]),\n    ),\n  );\n\n  return {\n    getSidebar: async (currentPath) => {\n      const matches = Object.keys(paths).some((path) =>\n        matchPath(path, currentPath),\n      );\n\n      if (!matches) {\n        return [];\n      }\n\n      const sidebar: SidebarItem[] = categories.map((category) => ({\n        type: \"category\" as const,\n        label: category.label,\n        collapsible: false,\n        items: category.tags.map((tag) => ({\n          type: \"doc\" as const,\n          id: joinUrl(navigationId, getKey(category.label, tag)),\n          label: tag,\n          badge: {\n            label: String(\n              items.filter((api) =>\n                api.categories.find((c) => c.tags.includes(tag)),\n              ).length,\n            ),\n            color: \"outline\" as const,\n          },\n        })),\n      }));\n\n      sidebar.unshift({\n        type: \"doc\" as const,\n        id: joinUrl(navigationId),\n        label: \"Overview\",\n        badge: { label: String(items.length), color: \"outline\" as const },\n      });\n\n      return sidebar;\n    },\n    getRoutes: () =>\n      Object.entries(paths).map(([path, tag]) => ({\n        path,\n        element: (\n          <Catalog\n            label={label}\n            categoryLabel={tag}\n            items={items}\n            filterCatalogItems={filterCatalogItems}\n            categories={categories}\n          />\n        ),\n      })),\n  };\n};\n"],"names":["Catalog","items","filterCatalogItems","label","categoryLabel","auth","useAuthState","match","useMatch","activeCategory","catalogItems","useSuspenseQuery","dataSet","jsxs","jsx","Helmet","Heading","api","t","getKey","Link","joinUrl","Markdown","category","tag","slugify","apiCatalogPlugin","navigationId","categories","paths","currentPath","path","matchPath","sidebar","c"],"mappings":"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"}