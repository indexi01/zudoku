{"version":3,"file":"removeParameters.js","sources":["../../src/lib/plugins/openapi/processors/removeParameters.ts"],"sourcesContent":["import type { ProcessorArg } from \"../../../../config/validators/BuildSchema.js\";\nimport type { OpenAPIDocument } from \"../../../oas/parser/index.js\";\nimport { type RecordAny, traverse } from \"./traverse.js\";\n\ninterface RemoveParametersOptions {\n  // Names of parameters to remove\n  names?: string[];\n  // Specific locations to remove parameters from ('query', 'header', 'path', 'cookie')\n  in?: string[];\n  // Custom filter function\n  shouldRemove?: ({ parameter }: { parameter: RecordAny }) => boolean;\n}\n\nexport const removeParameters =\n  ({ names, in: locations, shouldRemove }: RemoveParametersOptions = {}) =>\n  ({ schema }: ProcessorArg) =>\n    traverse(schema, (spec) => {\n      // Helper function to filter parameters\n      const filterParameters = (parameters: RecordAny[]) =>\n        parameters.filter((p) => {\n          if (names?.includes(p.name)) return false;\n          if (locations?.includes(p.in)) return false;\n          if (shouldRemove?.({ parameter: p })) return false;\n          return true;\n        });\n\n      // Handle components.parameters\n      if (spec.components?.parameters) {\n        spec = {\n          ...spec,\n          components: {\n            ...spec.components,\n            parameters: Object.fromEntries(\n              Object.entries(spec.components.parameters).filter(\n                ([_, param]) => {\n                  const p = param as RecordAny;\n                  if (p.$ref) return true; // Skip references\n                  return (\n                    !names?.includes(p.name) &&\n                    !locations?.includes(p.in) &&\n                    !shouldRemove?.({ parameter: p })\n                  );\n                },\n              ),\n            ),\n          },\n        };\n      }\n\n      // Handle paths\n      if (spec.paths) {\n        const updatedPaths: RecordAny = {};\n\n        for (const [path, pathItem] of Object.entries(spec.paths)) {\n          if (typeof pathItem !== \"object\" || pathItem === null) {\n            updatedPaths[path] = pathItem;\n            continue;\n          }\n\n          let updatedPathItem = { ...pathItem };\n\n          // Handle path-level parameters\n          if (\n            \"parameters\" in updatedPathItem &&\n            Array.isArray(updatedPathItem.parameters)\n          ) {\n            updatedPathItem.parameters = filterParameters(\n              updatedPathItem.parameters,\n            );\n          }\n\n          // Handle operation-level parameters\n          for (const method of Object.keys(updatedPathItem)) {\n            const pathItemWithMethods = updatedPathItem as Record<\n              string,\n              RecordAny\n            >;\n\n            if (\n              method === \"parameters\" ||\n              typeof pathItemWithMethods[method] !== \"object\"\n            ) {\n              continue;\n            }\n\n            const operation = pathItemWithMethods[method];\n            if (Array.isArray(operation.parameters)) {\n              pathItemWithMethods[method] = {\n                ...operation,\n                parameters: filterParameters(operation.parameters),\n              };\n              updatedPathItem = pathItemWithMethods;\n            }\n          }\n\n          updatedPaths[path] = updatedPathItem;\n        }\n\n        spec = { ...spec, paths: updatedPaths };\n      }\n\n      return spec;\n    }) as OpenAPIDocument;\n"],"names":["removeParameters","names","locations","shouldRemove","schema","traverse","spec","filterParameters","parameters","p","_a","_","param","updatedPaths","path","pathItem","updatedPathItem","method","pathItemWithMethods","operation"],"mappings":";AAaO,MAAMA,IACX,CAAC,EAAE,OAAAC,GAAO,IAAIC,GAAW,cAAAC,EAAa,IAA6B,OACnE,CAAC,EAAE,QAAAC,QACDC,EAASD,GAAQ,CAACE,MAAS;;AAEzB,QAAMC,IAAmB,CAACC,MACxBA,EAAW,OAAO,CAACC,MACb,EAAAR,KAAA,QAAAA,EAAO,SAASQ,EAAE,SAClBP,KAAA,QAAAA,EAAW,SAASO,EAAE,OACtBN,KAAA,QAAAA,EAAe,EAAE,WAAWM,EAAG,GAEpC;AA0BH,OAvBIC,IAAAJ,EAAK,eAAL,QAAAI,EAAiB,eACZJ,IAAA;AAAA,IACL,GAAGA;AAAA,IACH,YAAY;AAAA,MACV,GAAGA,EAAK;AAAA,MACR,YAAY,OAAO;AAAA,QACjB,OAAO,QAAQA,EAAK,WAAW,UAAU,EAAE;AAAA,UACzC,CAAC,CAACK,GAAGC,CAAK,MAAM;AACd,kBAAMH,IAAIG;AACN,mBAAAH,EAAE,OAAa,KAEjB,EAACR,KAAA,QAAAA,EAAO,SAASQ,EAAE,UACnB,EAACP,KAAA,QAAAA,EAAW,SAASO,EAAE,QACvB,EAACN,KAAA,QAAAA,EAAe,EAAE,WAAWM;UAAG;AAAA,QAEpC;AAAA,MACF;AAAA,IACF;AAAA,EAEJ,IAIEH,EAAK,OAAO;AACd,UAAMO,IAA0B,CAAC;AAEtB,eAAA,CAACC,GAAMC,CAAQ,KAAK,OAAO,QAAQT,EAAK,KAAK,GAAG;AACzD,UAAI,OAAOS,KAAa,YAAYA,MAAa,MAAM;AACrD,QAAAF,EAAaC,CAAI,IAAIC;AACrB;AAAA,MAAA;AAGE,UAAAC,IAAkB,EAAE,GAAGD,EAAS;AAGpC,MACE,gBAAgBC,KAChB,MAAM,QAAQA,EAAgB,UAAU,MAExCA,EAAgB,aAAaT;AAAA,QAC3BS,EAAgB;AAAA,MAClB;AAIF,iBAAWC,KAAU,OAAO,KAAKD,CAAe,GAAG;AACjD,cAAME,IAAsBF;AAK5B,YACEC,MAAW,gBACX,OAAOC,EAAoBD,CAAM,KAAM;AAEvC;AAGI,cAAAE,IAAYD,EAAoBD,CAAM;AAC5C,QAAI,MAAM,QAAQE,EAAU,UAAU,MACpCD,EAAoBD,CAAM,IAAI;AAAA,UAC5B,GAAGE;AAAA,UACH,YAAYZ,EAAiBY,EAAU,UAAU;AAAA,QACnD,GACkBH,IAAAE;AAAA,MACpB;AAGF,MAAAL,EAAaC,CAAI,IAAIE;AAAA,IAAA;AAGvB,IAAAV,IAAO,EAAE,GAAGA,GAAM,OAAOO,EAAa;AAAA,EAAA;AAGjC,SAAAP;AACT,CAAC;"}